(function(){function z(a){return new Promise(c=>setTimeout(c,a))}function V(a){L();if(M&&!q&&v){let [c,e]=N(a.target),b=l[c][e];b.start_cell||b.end_cell||b.wall||(b.wall=!0,a.target.classList.add("wall"))}}function h(a,c){return document.getElementById("cell-"+a+"-"+c)}function O(){for(let a=0;a<m;a++)for(let c=0;c<n;c++){let e=l[a][c],b=h(a,c);e.path=!1;e.wall||(e.end_cell=!1,b.classList.remove("end"),b.classList.remove("path"),e.visited=!1,e.distance=0,b.textContent="")}}function W(a){a=a.target;
let [c,e]=N(a),b=l[c][e];b.wall||b.start_cell||(O(),b.end_cell=!0,a.classList.add("end"),A=b,H(A),x&&w(u))}function P(a,c){for(var e=new Map,b=0;b<a.length;b++)e.has(a[b].charCodeAt(0))?e[a[b].charCodeAt(0)]++:e[a[b].charCodeAt(0)]=1;for(b=0;b<c.length;b++)if(0<e[c[b].charCodeAt(0)])return!0;return!1}function X(){if(q&&!Q){var a=[],c=[];for(var e=0;e<m;e++){a.push([]);c.push([]);for(var b=0;b<n;b++){O();var d=l[e][b];if(d.wall)a[e].push(""),c[e].push("");else{H(d);w(u);var f=void 0;for(var k of d.neighbors)if(l[k.x][k.y].path){f=
k;break}if(null===f||"undefined"===typeof f)a[e].push(""),c[e].push("");else{a[e].push(f.direction);d=u.getLowestDistanceNeighbor();for(var g of u.neighbors)if(g.x===d.x&&g.y===d.y){c[e].push(g.direction);break}}}}}for(e=0;e<m;e++)for(b=0;b<n;b++)if(g=l[e][b],f=a[e][b],k=c[e][b],!g.wall&&""!==f&&""!==k)for(let r of g.cardinal_neighbors)if(g=a[r.x][r.y],d=c[r.x][r.y],""!==g&&""!==d)if(!P(f,g)||f!==g&&f.length===g.length)h(e,b).classList.add("inflection_point"),h(r.x,r.y).classList.add("inflection_point");
else if(!P(k,d)||k!==d&&k.length===d.length)h(e,b).classList.add("inflection_point"),h(r.x,r.y).classList.add("inflection_point");Q=!0}}function L(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function R(){S&&T&&!q&&(L(),document.getElementById("start").removeEventListener("click",R),document.getElementById("start").disabled=!0,document.getElementById("visualization_mode").disabled=!0,document.getElementById("visualization_mode").classList.add("hidden"),
document.getElementById("vis_label").classList.add("hidden"),document.getElementById("mouse_mode").disabled=!0,document.getElementById("mouse_mode").classList.add("hidden"),document.getElementById("mouse_label").classList.add("hidden"),document.getElementById("wallMessage").classList.add("notShown"),p&&(Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.addEventListener("mouseover",W)}),document.getElementById("inflection").classList.remove("hidden")),q=!0,v=!1,H(A),t||p||!x||Y(),Z(),x?
t?z(m*n).then(()=>w(u)):w(u):x||p||(document.getElementById("wallMessage").classList.add("hidden"),document.getElementById("noPathMessage").classList.remove("hidden")))}function Z(){for(let a=0;a<m;a++)for(let c=0;c<n;c++)h(a,c).classList.remove("cell_hover")}function Y(){for(let a=0;a<m;a++)for(let c=0;c<n;c++){let e=l[a][c];e.visited||(e.wall=!0,h(a,c).classList.add("wall"))}}function w(a){a.path=!0;0!==a.distance&&(a.start_cell||(h(a.x,a.y).classList.remove("visited"),h(a.x,a.y).classList.add("path")),
t&&!p?z(200).then(()=>w(a.getLowestDistanceNeighbor())):w(a.getLowestDistanceNeighbor()))}function H(a){let c=1,e=new y;a.visited=!0;for(e.enqueue(a);!e.isEmpty();){c++;let b=e.dequeue();for(let d of b.neighbors.reverse()){let f=l[d.x][d.y];if("NE"===d.direction&&B("N","E",b,"NE"))b.neighbors.splice(b.neighbors.indexOf(d),1);else if("SE"===d.direction&&B("S","E",b,"SE"))b.neighbors.splice(b.neighbors.indexOf(d),1);else if("SW"===d.direction&&B("S","W",b,"SW"))b.neighbors.splice(b.neighbors.indexOf(d),
1);else if("NW"===d.direction&&B("N","W",b,"NW"))b.neighbors.splice(b.neighbors.indexOf(d),1);else if(f.start_cell&&(x=!0),f.distance>b.distance+d.connection_cost&&f.visited&&(f.distance=b.distance+d.connection_cost,t?z(c+30).then(()=>{h(f.x,f.y).textContent=(b.distance+d.connection_cost).toString().substring(0,4)}):f.start_cell&&p&&(h(f.x,f.y).textContent=(b.distance+d.connection_cost).toString().substring(0,4))),!f.visited&&!f.wall){f.visited=!0;f.distance=b.distance+d.connection_cost;let k=h(f.x,
f.y);t?z(c+30).then(()=>{k.textContent=(b.distance+d.connection_cost).toString().substring(0,4);f.start_cell||k.classList.add("visited")}):f.start_cell&&p&&(k.textContent=(b.distance+d.connection_cost).toString().substring(0,4));f.wall||e.enqueue(f)}}}}function B(a,c,e,b){let d=null,f=null,k=null;for(let g of e.neighbors)g.direction===a&&(d=l[g.x][g.y]),g.direction===c&&(f=l[g.x][g.y]),g.direction===b&&(k=l[g.x][g.y]);return null===d||null===f||null===k?!1:d.wall&&f.wall?!k.wall:!1}function N(a){return[a.id.split("-")[1],
a.id.split("-")[2]]}function aa(a){!q&&C&&D&&!U&&(m=Number(E.value),n=Number(F.value),E.disabled=!0,F.disabled=!0,a.target.classList.add("hidden"),document.getElementById("start").disabled=!1,document.getElementById("start").classList.remove("hidden"),ba(),U=!0,document.getElementById("startMessage").classList.remove("hidden"))}function ca(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(C=!0,a=document.getElementById("invalidRows"),"undefined"!=
typeof a&&null!=a&&a.remove()):(C&&(a=document.createElement("p"),a.id="invalidRows",a.textContent="Valid range is 1-75 rows",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),C=!1)}function da(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(D=!0,a=document.getElementById("invalidCols"),"undefined"!=typeof a&&null!=a&&a.remove()):(D&&(a=document.createElement("p"),
a.id="invalidCols",a.textContent="Valid range is 1-75 columns",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),D=!1)}function I(a){M=void 0===a.buttons?1===a.which:1===a.buttons}function ba(){for(let a=0;a<n;a++){l.push([]);const c=document.createElement("div");c.id="col-"+a;c.classList.add("col");c.draggable=!1;c.ondragstart=function(){return!1};J.appendChild(c);for(let e=0;e<m;e++){const b=new ea(a,e);l[a].push(b);l[a][e].setNeighbors();
const d=document.createElement("div");d.id="cell-"+a+"-"+e;d.classList.add("cell");d.classList.add("cell_hover");625>n*m?d.classList.add("large_cell"):1600>n*m?d.classList.add("medium_cell"):3600>n*m?d.classList.add("small_cell"):d.classList.add("x-small_cell");c.appendChild(d);d.addEventListener("mouseup",f=>b.handleClick(f));d.draggable=!1;d.ondragstart=function(){return!1}}}}let q=!1,U=!1,C=!0,D=!0,m=30,n=30,K=!0,G=!1,v=!1,S=!1,T=!1,Q=!1,M=!1,t=!1,p=!1,x=!1,u,A;const l=[],J=document.getElementById("gameBoard_UI"),
E=document.getElementById("rowsInput"),F=document.getElementById("colsInput");class ea{constructor(a,c){this.x=a;this.y=c;this.neighbors=[];this.cardinal_neighbors=[];this.end_cell=this.start_cell=this.path=this.wall=!1;this.distance=0;this.visited=!1}setNeighbors(){const a=[-1,0,1];for(let b of a)for(let d of a){var c=this.x+b,e=this.y+d;0<=c&&c<n&&0<=e&&e<m&&(0!==b||0!==d)&&(c=0===b&&-1===d?"N":1===b&&-1===d?"NE":1===b&&0===d?"E":1===b&&1===d?"SE":0===b&&1===d?"S":-1===b&&1===d?"SW":-1===b&&0===
d?"W":"NW",0===b||0===d?(this.neighbors.push({x:this.x+b,y:this.y+d,connection_cost:1,direction:c}),this.cardinal_neighbors.push({x:this.x+b,y:this.y+d,connection_cost:1,direction:c})):this.neighbors.push({x:this.x+b,y:this.y+d,connection_cost:Math.sqrt(2),direction:c}))}}getLowestDistanceNeighbor(){let a=Infinity,c=null;for(let e of this.neighbors){let b=l[e.x][e.y];b.distance<a&&b.visited&&!b.wall&&(a=b.distance,c=b)}return c}handleClick(a){if(!K||q||v||0!==a.button)if(!G||q||v||0!==a.button)G||
K||!v||q||2!==a.button||(this.wall=!1,h(this.x,this.y).classList.remove("wall"));else for(A=this,this.end_cell=!0,h(this.x,this.y).classList.add("end"),G=!1,T=!0,document.getElementById("endMessage").classList.add("hidden"),document.getElementById("wallMessage").classList.remove("hidden"),v=!0,a=0;a<n;a++)for(let c=0;c<m;c++)h(a,c).addEventListener("mouseover",V);else this.start_cell=!0,h(this.x,this.y).classList.add("start"),u=this,K=!1,S=G=!0,document.getElementById("startMessage").classList.add("hidden"),
document.getElementById("endMessage").classList.remove("hidden")}}(function(){document.getElementById("start").addEventListener("click",R);document.getElementById("buildGrid").addEventListener("click",aa);document.getElementById("inflection").addEventListener("click",X);document.getElementById("visualization_mode").addEventListener("input",()=>{if(t=!t)p=document.getElementById("mouse_mode").checked=!1});document.getElementById("visualization_mode").checked=!1;document.getElementById("mouse_mode").addEventListener("input",
()=>{if(p=!p)t=document.getElementById("visualization_mode").checked=!1});document.getElementById("mouse_mode").checked=!1;document.body.onmousedown=I;document.body.onmousemove=I;document.body.onmouseup=I;E.addEventListener("input",ca);F.addEventListener("input",da);F.value="30";E.value="30";document.getElementById("start").disabled=!0;document.oncontextmenu=()=>!1;document.draggable=!1;document.ondragstart=function(){return!1};J.draggable=!1;J.ondragstart=function(){return!1}})();class y{constructor(){this.elements=
[]}}y.prototype.enqueue=function(a){this.elements.push(a)};y.prototype.dequeue=function(){return this.elements.shift()};y.prototype.isEmpty=function(){return 0===this.elements.length};y.prototype.length=function(){return this.elements.length}})();
