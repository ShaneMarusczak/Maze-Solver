(function(){function x(a){return new Promise(c=>setTimeout(c,a))}function Q(a){if(I&&!p){let [c,e]=J(a.target),b=g[c][e];b.s||b.l||b.h||(b.h=!0,a.target.classList.add("wall"))}}function h(a,c){return document.getElementById("cell-"+a+"-"+c)}function K(a){for(let c=0;c<k;c++)for(let e=0;e<l;e++){let b=g[c][e],d=h(c,e);b.h||(b.l=!1,d.classList.remove("end"),b.path=!1,d.classList.remove("path"),b.m=!1,b.i=0,d.textContent="",a&&b.A())}}function R(a){a=a.target;let [c,e]=J(a),b=g[c][e];b.h||b.s||!b.m||
(K(!1),b.l=!0,a.classList.add("end"),q=b,E(q),y&&r(v))}function L(){M&&N&&!p&&(document.getElementById("start").removeEventListener("click",L),document.getElementById("start").disabled=!0,document.getElementById("visualization_mode").disabled=!0,document.getElementById("visualization_mode").classList.add("hidden"),document.getElementById("vis_label").classList.add("hidden"),document.getElementById("mouse_mode").disabled=!0,document.getElementById("mouse_mode").classList.add("hidden"),document.getElementById("mouse_label").classList.add("hidden"),
t&&Array.from(document.querySelectorAll(".cell")).forEach(a=>{a.addEventListener("mouseover",R)}),p=!0,E(q),S(),y&&(m?x(k*l*2.5).then(()=>r(v)):r(v)))}function S(){for(let a=0;a<k;a++)for(let c=0;c<l;c++)h(a,c).classList.remove("cell_hover")}function r(a){a.path=!0;0!==a.i&&(a.s||(h(a.x,a.y).classList.remove("visited"),h(a.x,a.y).classList.add("path")),m&&!t?x(200).then(()=>r(a.v())):r(a.v()))}function E(a){let c=1,e=new w;a.m=!0;for(e.u(a);!e.C();){c++;let b=e.B();for(let d of b.g.reverse()){let f=
g[d.x][d.y];if("NE"===d.direction&&z("N","E",b,"NE"))b.g.splice(b.g.indexOf(d),1);else if("SE"===d.direction&&z("S","E",b,"SE"))b.g.splice(b.g.indexOf(d),1);else if("SW"===d.direction&&z("S","W",b,"SW"))b.g.splice(b.g.indexOf(d),1);else if("NW"===d.direction&&z("N","W",b,"NW"))b.g.splice(b.g.indexOf(d),1);else if(f.s&&(y=!0),f.i>b.i+d.o&&f.m&&(f.i=b.i+d.o,m&&x(3*c).then(()=>{h(f.x,f.y).textContent=(b.i+d.o).toString().substr(0,5)})),!f.m&&!f.h){f.m=!0;f.i=b.i+d.o;let u=h(f.x,f.y);m&&!f.s&&x(2*c).then(()=>
{u.textContent=(b.i+d.o).toString().substr(0,5);u.classList.add("visited")});f.h||e.u(f)}}}}function z(a,c,e,b){let d=null,f=null,u=null;for(let n of e.g)n.direction===a&&(d=g[n.x][n.y]),n.direction===c&&(f=g[n.x][n.y]),n.direction===b&&(u=g[n.x][n.y]);return null===d||null===f||null===u?!1:d.h&&f.h?!u.h:!1}function J(a){return[a.id.split("-")[1],a.id.split("-")[2]]}function T(a){!p&&A&&B&&!O&&(k=Number(C.value),l=Number(D.value),C.disabled=!0,D.disabled=!0,a.target.classList.add("hidden"),document.getElementById("start").disabled=
!1,document.getElementById("start").classList.remove("hidden"),U(),O=!0)}function V(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(A=!0,a=document.getElementById("invalidRows"),"undefined"!=typeof a&&null!=a&&a.remove()):(A&&(a=document.createElement("p"),a.id="invalidRows",a.textContent="Valid range is 1-75 rows",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),
A=!1)}function W(a){/^\d{0,2}$/.test(a.target.value)&&75>=Number(a.target.value)&&0<Number(a.target.value)&&""!==a.target.value?(B=!0,a=document.getElementById("invalidCols"),"undefined"!=typeof a&&null!=a&&a.remove()):(B&&(a=document.createElement("p"),a.id="invalidCols",a.textContent="Valid range is 1-75 columns",a.classList.add("bad"),document.getElementById("messages").insertBefore(a,document.getElementById("messages").firstChild)),B=!1)}function F(a){I=void 0===a.buttons?1===a.which:1===a.buttons}
function U(){for(let a=0;a<l;a++){g.push([]);const c=document.createElement("div");c.id="col-"+a;c.classList.add("col");c.draggable=!1;c.j=function(){return!1};G.appendChild(c);for(let e=0;e<k;e++){const b=new X(a,e);g[a].push(b);g[a][e].A();const d=document.createElement("div");d.id="cell-"+a+"-"+e;d.classList.add("cell");d.classList.add("cell_hover");625>l*k?d.classList.add("large_cell"):1600>l*k?d.classList.add("medium_cell"):3600>l*k?d.classList.add("small_cell"):d.classList.add("x-small_cell");
c.appendChild(d);d.addEventListener("mouseup",f=>b.j(f));d.draggable=!1;d.j=function(){return!1}}}}let p=!1,O=!1,A=!0,B=!0,k=30,l=30,P=!0,H=!1,M=!1,N=!1,I=!1,m=!1,t=!1,y=!1,v,q;const g=[],G=document.getElementById("gameBoard_UI"),C=document.getElementById("rowsInput"),D=document.getElementById("colsInput");class X{constructor(a,c){this.x=a;this.y=c;this.g=[];this.l=this.s=this.path=this.h=!1;this.i=0;this.m=!1}A(){this.g=[];const a=[-1,0,1];for(let b of a)for(let d of a){var c=this.x+b,e=this.y+d;
0<=c&&c<l&&0<=e&&e<k&&(0!==b||0!==d)&&(c=0===b&&-1===d?"N":1===b&&-1===d?"NE":1===b&&0===d?"E":1===b&&1===d?"SE":0===b&&1===d?"S":-1===b&&1===d?"SW":-1===b&&0===d?"W":"NW",0===b||0===d?this.g.push({x:this.x+b,y:this.y+d,o:1,direction:c}):this.g.push({x:this.x+b,y:this.y+d,o:Math.sqrt(2),direction:c}))}}v(){let a=Infinity,c=null;for(let e of this.g){let b=g[e.x][e.y];b.i<a&&b.m&&!b.h&&(a=b.i,c=b)}return c}j(a){if(0===a.button)if(P&&!p)this.s=!0,h(this.x,this.y).classList.add("start"),v=this,P=!1,M=
H=!0;else{if(H&&!p)for(q=this,this.l=!0,h(this.x,this.y).classList.add("end"),H=!1,N=!0,a=0;a<l;a++)for(let c=0;c<k;c++)h(a,c).addEventListener("mouseover",Q)}else 2===a.button&&this.u()}u(){if(t&&p){var a=h(this.x,this.y);if(this.h)this.h=!1,a.classList.remove("wall"),0<this.g.filter(c=>{let e="N"===c.direction||"E"===c.direction||"S"===c.direction||"W"===c.direction;return!g[c.x][c.y].h&&e}).length&&(K(!0),this.l=!0,a.classList.add("end"),q=this,E(q),y&&r(v));else{this.h=!0;a.classList.add("wall");
this.l=!1;a.classList.remove("end");let {x:c,y:e}=this.g.find(b=>g[b.x][b.y].path);g[c][e].path=!1;h(c,e).classList.remove("path");g[c][e].l=!0;h(c,e).classList.add("end")}}}}(function(){document.getElementById("start").addEventListener("click",L);document.getElementById("buildGrid").addEventListener("click",T);document.getElementById("visualization_mode").addEventListener("input",()=>{m=!m});m=document.getElementById("visualization_mode").checked;document.getElementById("mouse_mode").addEventListener("input",
()=>{(t=!t)?(document.getElementById("visualization_mode").disabled=!0,m=document.getElementById("visualization_mode").checked=!1):document.getElementById("visualization_mode").disabled=!1});if(t=document.getElementById("mouse_mode").checked)document.getElementById("visualization_mode").disabled=!0,m=document.getElementById("visualization_mode").checked=!1;document.body.onmousedown=F;document.body.onmousemove=F;document.body.onmouseup=F;C.addEventListener("input",V);D.addEventListener("input",W);
D.value="30";C.value="30";document.getElementById("start").disabled=!0;document.oncontextmenu=()=>!1;document.draggable=!1;document.j=function(){return!1};G.draggable=!1;G.j=function(){return!1}})();class w{constructor(){this.j=[]}}w.prototype.u=function(a){this.j.push(a)};w.prototype.B=function(){return this.j.shift()};w.prototype.C=function(){return 0===this.j.length};w.prototype.length=function(){return this.j.length}})();
